server_name: agent-mesh

listen: 0.0.0.0:4222
http_port: 8222

jetstream {
  store_dir: /data/nats
  max_mem: 256MB
  max_file: 5GB
}

websocket {
  listen: 0.0.0.0:9222
  no_tls: true
}

authorization {
  users: [
    # Operator — full access
    {
      nkey: "UB7RXBIS6HLWS2PIOWOV3D5FL77XPECR742CPT7ZAB4MG3QOYFY6FMVA"
      permissions: {
        publish: ">"
        subscribe: ">"
      }
    }

    # Sentinel — SRE: full mesh access + system events
    {
      nkey: "UDWG5XSCAXPDRIHFRJRXPPUMPKV73BW5GQ4FQDK5X24QBSSSMBUFWTFU"
      permissions: {
        publish: {
          allow: ["mesh.channel.>", "mesh.dm.>", "mesh.presence.sentinel", "mesh.telemetry.sentinel", "mesh.system.>", "$JS.API.>", "$KV.MESH-MEMBERS.>", "$KV.MESH-PRESENCE.>", "$KV.MESH-PROCESS-RULES.>", "_INBOX.>"]
        }
        subscribe: {
          allow: ["mesh.channel.>", "mesh.dm.sentinel", "mesh.session.sentinel.>", "mesh.presence.>", "mesh.receipt.>", "mesh.telemetry.>", "mesh.system.>", "$JS.API.>", "$KV.MESH-PROCESS-RULES.>", "_INBOX.>"]
        }
      }
    }

    # Junior — agent: mesh channels + own DMs + own presence
    {
      nkey: "UAUSYZI5622CNVLP5M3KWOZUAOIZVMX5H3DYCHJEELTK7UYSWW7KC4ZB"
      permissions: {
        publish: {
          allow: ["mesh.channel.>", "mesh.dm.>", "mesh.presence.junior", "mesh.telemetry.junior", "_INBOX.>", "$JS.API.>", "$KV.MESH-PRESENCE.>", "$KV.MESH-TELEMETRY.>", "$KV.MESH-PROCESS-RULES.>"]
        }
        subscribe: {
          allow: ["mesh.channel.>", "mesh.dm.junior", "mesh.session.junior.>", "mesh.presence.>", "mesh.system.>", "$JS.API.>", "$KV.MESH-PROCESS-RULES.>", "_INBOX.>"]
        }
      }
    }

    # Perceptor — agent: mesh channels + own DMs + own presence
    {
      nkey: "UDUQ7CDNSTE35BIGYXKOJVBG2TKTDECI7XCBF4NSN3SZGISV2YV6LEFU"
      permissions: {
        publish: {
          allow: ["mesh.channel.>", "mesh.dm.>", "mesh.presence.perceptor", "mesh.telemetry.perceptor", "$JS.API.>"]
        }
        subscribe: {
          allow: ["mesh.channel.>", "mesh.dm.perceptor", "mesh.presence.>", "mesh.system.>", "$JS.API.>", "_INBOX.>"]
        }
      }
    }

    # Dashboard-gp — human web dashboard: channels + system only, no DMs
    {
      nkey: "UCOQYY6YVBJEJPNHGZKCLIBRGET4DMK4E4SYWW36SNI2KDT3W6WWQF7X"
      permissions: {
        publish: {
          allow: ["mesh.channel.>", "mesh.presence.>", "mesh.session.>", "$KV.MESH-PRESENCE.>", "$JS.API.>"]
          deny: ["mesh.dm.>"]
        }
        subscribe: {
          allow: ["mesh.channel.>", "mesh.system.>", "mesh.presence.>", "mesh.telemetry.>", "mesh.session.>", "mesh.receipt.>", "_INBOX.>"]
        }
      }
    }

    # Dashboard-server — SvelteKit backend: JetStream read for history replay
    {
      nkey: "UCNHAWDJX3PBSDFNXEGHMEUDAC7WHCM3L2LPLMQ5AWLW72W7JLNRODRE"
      permissions: {
        publish: {
          allow: ["mesh.channel.>", "$JS.API.>", "$KV.MESH-MEMBERS.>", "$KV.MESH-TELEMETRY.>", "$KV.MESH-PRESENCE.>"]
        }
        subscribe: {
          allow: ["$JS.API.>", "mesh.telemetry.>", "$KV.MESH-PROCESS-RULES.>", "_INBOX.>"]
        }
      }
    }

  ]
}
